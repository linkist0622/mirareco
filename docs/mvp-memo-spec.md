# ミラレコ Phase1（MVP）設計：メモ機能

## 1. ゴール（何ができればOK？）
- ユーザーが「タイトル／本文／作成日」を入力して **メモを新規作成** できる
- 作成したメモを **一覧表示／詳細表示** できる
- メモを **編集／削除（論理削除）** できる
- 画面は **モバイルファースト**。文字は大きく、操作は迷わない
- データは **ログインユーザーごとに分離**（RLS）され、安全に保管される

> 📝用語メモ  
> **MVP**：最小限の価値を提供できる最初のバージョン  
> **論理削除**：データを消さず「削除フラグ」を立てて非表示にするやり方（後から復元できる）

---

## 2. 画面フロー（UIフロー）
1. **ログイン** → 2. **メモ一覧** → 3. **メモ作成** → （保存）→ **一覧へ戻る**  
　　　　　　　　　　　　↘︎ 4. **メモ詳細** → **編集** → （保存）→ **一覧へ戻る**

- 一覧（/notes）
  - 上部：アプリ名「ミラレコ」、右上＋ボタン（新規）
  - コンテンツ：カード型リスト（タイトル／日付／先頭数行のプレビュー）
  - 下部：ページネーション or 無限スクロール（MVPはページネーションでOK）

- 作成・編集（/notes/new, /notes/[id]/edit）
  - 入力：タイトル（必須, 50文字）、本文（10000文字まで）、日付（自動：作成日）
  - 保存・キャンセルボタン（保存後は一覧へ）

- 詳細（/notes/[id]）
  - 表示：タイトル／本文／作成日・更新日
  - アクション：編集／削除（確認ダイアログつき）

> 📝用語メモ  
> **モバイルファースト**：スマホ画面を最優先で設計する考え方  
> **カードUI**：情報の塊を箱（カード）で区切って見やすくするデザイン

---

## 3. データモデル（Supabase / PostgreSQL）

### テーブル：`notes`
| カラム名        | 型          | 必須 | 既定値/備考                   |
|---|---|---|---|
| id              | uuid        | ✓   | `gen_random_uuid()`           |
| user_id         | uuid        | ✓   | Supabaseの認証ユーザーID      |
| title           | text        | ✓   | 1〜50文字                      |
| body            | text        |     | 最大 10,000 文字              |
| created_at      | timestamptz | ✓   | `now()`                       |
| updated_at      | timestamptz | ✓   | `now()`（トリガーで自動更新） |
| is_deleted      | boolean     | ✓   | 既定 `false`（論理削除）      |

（拡張用の将来カラム例：`tags text[]`, `shared_with uuid[]` ）

> 📝用語メモ  
> **uuid**：重複しにくいIDを自動発行する方式  
> **timestamptz**：タイムゾーン付き日時

---

## 4. RLS（Row Level Security）方針
- **SELECT/INSERT/UPDATE**：`auth.uid() = notes.user_id` のときのみ許可  
- **DELETE**は実テーブルで禁止。代わりに `is_deleted=true` へ更新（論理削除）  
- すべてのクエリは `is_deleted=false` の行だけを対象にする

> 📝用語メモ  
> **RLS**：行ごとにアクセス制御を行うDBの仕組み。ユーザーAはAのデータしか見えない。

---

## 5. API設計（FastAPI：/api/notes）
- `GET /api/notes?limit&offset`：一覧（自分の & 未削除のみ）
- `GET /api/notes/{id}`：詳細（自分の & 未削除のみ）
- `POST /api/notes`：作成（`title`, `body`）
- `PUT /api/notes/{id}`：更新（`title`, `body`）
- `PATCH /api/notes/{id}/delete`：論理削除（`is_deleted=true`）

**認証**：フロントからのリクエストに Supabase のセッショントークンを付与 → FastAPI で検証  
**バリデーション**：`title` 必須・50文字以内、`body` 長文許可（10,000文字以内）

> 📝用語メモ  
> **REST API**：URLとHTTPメソッド（GET/POSTなど）で操作を分ける一般的な設計  
> **バリデーション**：入力値のチェック

---

## 6. フロント（Next.js）UI設計（コンポーネント）
- `NoteList`：カードリスト表示（タイトル／日付／抜粋）
- `NoteForm`：タイトル・本文の入力、保存・キャンセル
- `TopBar`：アプリ名、＋新規ボタン
- `ConfirmDialog`：削除前の確認
- 入力補助：タイトルは **残り文字数** 表示、本文は **自動改行 & 行間広め**

> 📝UIメモ  
> - 文字サイズ：本文 16–18px（最小でも16px）、タイトル 20–24px  
> - 余白：カード内上下16–20pxで「ゆったり」  
> - 色：メイン1色＋アクセント1色＋グレー系で最小限に（高齢者向けの可読性重視）

---

## 7. 受け入れ基準（Acceptance Criteria）
- [ ] ログイン後、/notes にアクセスすると自分のメモだけが日付降順で見える  
- [ ] 「＋」からタイトル・本文を入力して保存すると一覧に反映される  
- [ ] 一覧から詳細に遷移し、内容が正しく表示される  
- [ ] 詳細から編集して保存すると、更新日時が変わり内容が更新される  
- [ ] 削除操作で確認ダイアログが出て、OKで一覧から消える（DBは `is_deleted=true`）  
- [ ] 別ユーザーのメモはAPI・DBレベルで取得できない（RLSテストで確認）  
- [ ] スマホ幅（375px目安）でレイアウトが崩れない・文字が読みやすい

---

## 8. 実装タスク（順序つき）
1. **リポジトリ整備**：`README.md（マスタードキュメント）` を最新化  
2. **Supabaseプロジェクト作成**＋`notes` テーブル作成、RLS有効化・ポリシー作成  
3. **FastAPI雛形**：認証ミドルウェア（Supabaseトークン検証）＋ `/api/notes` ルートを用意  
4. **Next.js雛形**：`/notes` 一覧ページと `/notes/new` 作成ページを用意  
5. **CRUD配線**：フォーム → API 呼び出し → DB まで通す  
6. **論理削除**：詳細ページから削除操作 → 一覧反映  
7. **UI微調整**：文字サイズ・余白・入力補助（残り文字数表示）  
8. **E2E動作確認**：多アカウントでRLS確認、スマホ実機表示確認  
9. **ドキュメント**：操作手順＆スクリーンショットを `docs/` に追加

> 🔎 このタスクでは、随所で **マスタードキュメントの「開発方針」「UI/UX」** を参照します。

---

## 9. 将来拡張の置き場所（設計の余白）
- 共有（家族招待 & 閲覧権限）：`shared_with` に家族の `user_id` を入れ、RLS条件に加える  
- タグ・検索：`tags text[]`、`GIN` インデックス、全文検索（将来）  
- 画像添付：`storage` 連携、本文中プレースホルダ記法  
- AIサポート（Phase3）：要約／下書き支援／思い出テンプレ

---

# 次アクション（すぐやること）
1) **`docs/mvp-memo-spec.md` を作成**（この内容をそのまま保存）  
2) **Supabaseで `notes` テーブルとRLSポリシー** を作る  
3) **FastAPI & Next.js の最小雛形** を生成
